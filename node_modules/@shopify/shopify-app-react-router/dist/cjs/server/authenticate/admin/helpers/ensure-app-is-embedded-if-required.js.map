{"version":3,"file":"ensure-app-is-embedded-if-required.js","sources":["../../../../../../../src/server/authenticate/admin/helpers/ensure-app-is-embedded-if-required.ts"],"sourcesContent":["import {BasicParams, AppDistribution} from '../../../types';\n\nimport {redirectToShopifyOrAppRoot} from './redirect-to-shopify-or-app-root';\n\nexport const ensureAppIsEmbeddedIfRequired = async (\n  params: BasicParams,\n  request: Request,\n) => {\n  const {api, logger, config} = params;\n  const url = new URL(request.url);\n\n  const shop = url.searchParams.get('shop')!;\n\n  if (\n    config.distribution !== AppDistribution.ShopifyAdmin &&\n    url.searchParams.get('embedded') !== '1'\n  ) {\n    logger.debug('App is not embedded, redirecting to Shopify', {shop});\n    await redirectToShopifyOrAppRoot(request, {api, logger, config});\n  }\n};\n"],"names":["AppDistribution","redirectToShopifyOrAppRoot"],"mappings":";;;;;AAIO,MAAM,6BAA6B,GAAG,OAC3C,MAAmB,EACnB,OAAgB,KACd;IACF,MAAM,EAAC,GAAG,EAAE,MAAM,EAAE,MAAM,EAAC,GAAG,MAAM;IACpC,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC;IAEhC,MAAM,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAE;AAE1C,IAAA,IACE,MAAM,CAAC,YAAY,KAAKA,qBAAe,CAAC,YAAY;QACpD,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,GAAG,EACxC;QACA,MAAM,CAAC,KAAK,CAAC,6CAA6C,EAAE,EAAC,IAAI,EAAC,CAAC;AACnE,QAAA,MAAMC,qDAA0B,CAAC,OAAO,EAAE,EAAC,GAAG,EAAU,MAAM,EAAC,CAAC;IAClE;AACF;;;;"}