'use strict';

var types = require('../../types.js');
var _const = require('../const.js');

function addDocumentResponseHeadersFactory(params) {
    const { api, config } = params;
    return function (request, headers) {
        const { searchParams } = new URL(request.url);
        const shop = api.utils.sanitizeShop(searchParams.get('shop'));
        const isEmbeddedApp = config.distribution !== types.AppDistribution.ShopifyAdmin;
        addDocumentResponseHeaders(headers, isEmbeddedApp, shop);
    };
}
function addDocumentResponseHeaders(headers, isEmbeddedApp, shop) {
    if (shop) {
        headers.set('Link', `<${_const.CDN_URL}>; rel="preconnect", <${_const.APP_BRIDGE_URL}>; rel="preload"; as="script", <${_const.POLARIS_URL}>; rel="preload"; as="script"`);
    }
    if (isEmbeddedApp) {
        if (shop) {
            headers.set('Content-Security-Policy', `frame-ancestors https://${shop} https://admin.shopify.com https://*.spin.dev https://admin.myshopify.io https://admin.shop.dev;`);
        }
    }
    else {
        headers.set('Content-Security-Policy', `frame-ancestors 'none';`);
    }
}

exports.addDocumentResponseHeaders = addDocumentResponseHeaders;
exports.addDocumentResponseHeadersFactory = addDocumentResponseHeadersFactory;
//# sourceMappingURL=add-response-headers.js.map
