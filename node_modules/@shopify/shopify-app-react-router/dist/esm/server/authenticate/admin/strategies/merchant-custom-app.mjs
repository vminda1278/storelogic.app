import { ShopifyError } from '@shopify/shopify-api';
import '../../../types.mjs';
import 'react-router';
import { handleClientErrorFactory } from '../helpers/handle-client-error.mjs';

const createMerchantCustomAuthStrategy = (params) => {
    const { api, logger } = params;
    async function authenticate(_request, sessionContext) {
        const { shop } = sessionContext;
        logger.debug('Building session from configured access token for merchant custom app', { shop });
        const session = api.session.customAppSession(shop);
        return session;
    }
    function handleClientError(request) {
        return handleClientErrorFactory({
            request,
            onError: async ({ error }) => {
                if (error.response.code === 401) {
                    logger.info('Request failed with 401. Review your API credentials or generate new tokens. https://shopify.dev/docs/apps/build/authentication-authorization/access-token-types/generate-app-access-tokens-admin#rotating-api-credentials-for-admin-created-apps ');
                    throw new ShopifyError('Unauthorized: Access token has been revoked.');
                }
            },
        });
    }
    return {
        authenticate,
        handleClientError,
    };
};

export { createMerchantCustomAuthStrategy };
//# sourceMappingURL=merchant-custom-app.mjs.map
