import { AppDistribution } from '../../types.mjs';
import { CDN_URL, APP_BRIDGE_URL, POLARIS_URL } from '../const.mjs';

function addDocumentResponseHeadersFactory(params) {
    const { api, config } = params;
    return function (request, headers) {
        const { searchParams } = new URL(request.url);
        const shop = api.utils.sanitizeShop(searchParams.get('shop'));
        const isEmbeddedApp = config.distribution !== AppDistribution.ShopifyAdmin;
        addDocumentResponseHeaders(headers, isEmbeddedApp, shop);
    };
}
function addDocumentResponseHeaders(headers, isEmbeddedApp, shop) {
    if (shop) {
        headers.set('Link', `<${CDN_URL}>; rel="preconnect", <${APP_BRIDGE_URL}>; rel="preload"; as="script", <${POLARIS_URL}>; rel="preload"; as="script"`);
    }
    if (isEmbeddedApp) {
        if (shop) {
            headers.set('Content-Security-Policy', `frame-ancestors https://${shop} https://admin.shopify.com https://*.spin.dev https://admin.myshopify.io https://admin.shop.dev;`);
        }
    }
    else {
        headers.set('Content-Security-Policy', `frame-ancestors 'none';`);
    }
}

export { addDocumentResponseHeaders, addDocumentResponseHeadersFactory };
//# sourceMappingURL=add-response-headers.mjs.map
